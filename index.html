<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Royal Roulette - Final Fix</title>
    <style>
        /* --- CORE --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            background: #120505;
            font-family: 'Arial', sans-serif;
            height: 100vh; width: 100vw;
            overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* --- 1. FULL SCREEN TABLE --- */
        .table-view {
            width: 100%; height: 100%;
            position: absolute; top: 0; left: 0;
            background: url('assets/table_dark.jpg') no-repeat center/100% 100%;
            z-index: 10;
        }

        /* --- GRID SYSTEM (Adjusted for Accuracy) --- */
        
        /* Area for Numbers 1 to 36 */
        .numbers-grid {
            position: absolute;
            top: 13.5%;      /* Image me jahan 1,2,3 shuru hoty hain */
            left: 27%;       /* Sidebar bets ke baad */
            width: 70%;      /* Numbers ki churai */
            height: 73%;     /* 34,35,36 tak ki lambai */
            display: grid;
            grid-template-columns: 1fr 1fr 1fr; /* 3 Columns */
            grid-template-rows: repeat(12, 1fr); /* 12 Rows */
            gap: 1px;
        }

        /* Zero "0" Area */
        .zero-zone {
            position: absolute; top: 6.5%; left: 27%; width: 70%; height: 6.5%;
            z-index: 15;
        }

        /* Side Bets (Left Column) - Simplified Mapping */
        .side-bets-container {
            position: absolute; top: 13.5%; left: 3%; width: 23%; height: 73%;
            display: flex; flex-direction: column;
        }
        .side-block-1 { height: 33.33%; width: 100%; } /* 1st 12 */
        .side-block-2 { height: 33.33%; width: 100%; } /* 2nd 12 */
        .side-block-3 { height: 33.33%; width: 100%; } /* 3rd 12 */

        /* Click Zone Style (Debug border hata dia hai) */
        .click-zone { position: relative; }

        /* Chips on Table */
        .chip-placed {
            position: absolute; top: 50%; left: 50%; 
            width: 32px; height: 32px; /* Bigger chips on table */
            transform: translate(-50%, -50%) scale(0);
            animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            pointer-events: none;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.8)); 
            z-index: 20;
        }
        @keyframes popIn { to { transform: translate(-50%, -50%) scale(1); } }

        /* --- 2. TIMER (TOP LEFT) --- */
        .timer-badge {
            position: absolute; top: 15px; left: 15px;
            width: 55px; height: 55px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #ffd700; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            z-index: 50; box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .timer-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .timer-circle {
            fill: none; stroke: #ffd700; stroke-width: 4;
            stroke-dasharray: 125; stroke-dashoffset: 0;
            transition: stroke-dashoffset 1s linear, stroke 0.3s;
        }
        .timer-text { position: absolute; color: #fff; font-weight: bold; font-size: 20px; }
        .timer-danger .timer-circle { stroke: #ff0000; }
        .timer-danger .timer-text { color: #ff0000; animation: pulse 0.5s infinite; }
        @keyframes pulse { 50% { opacity: 0.5; } }

        /* --- 3. SINGLE CHIP SELECTOR (RIGHT SIDE) --- */
        .chip-selector-area {
            position: absolute; right: 10px; top: 50%; 
            transform: translateY(-50%);
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            z-index: 60;
        }

        .arrow-btn {
            width: 40px; height: 40px;
            background: url('assets/btn_arrow.png') no-repeat center/contain;
            cursor: pointer; filter: drop-shadow(0 2px 5px #000);
            transition: transform 0.1s;
        }
        .arrow-btn.up { transform: rotate(0deg); }
        .arrow-btn.down { transform: rotate(180deg); }
        .arrow-btn:active { transform: scale(0.9) rotate(inherit); }

        /* The Main Big Chip */
        .current-chip {
            width: 75px; height: 75px; /* BIGGER CHIP */
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.8));
        }
        .chip-anim { animation: chipBounce 0.3s; }
        @keyframes chipBounce { 0%{transform:scale(0.8);} 50%{transform:scale(1.1);} 100%{transform:scale(1);} }

        /* --- 4. BOTTOM STATS (Minimal) --- */
        .bottom-stats {
            position: absolute; bottom: 0; left: 0; width: 100%;
            height: 40px;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            display: flex; align-items: flex-end; justify-content: space-between;
            padding: 5px 15px; z-index: 60; pointer-events: none;
        }
        .stat-group { font-size: 11px; font-weight: 600; text-shadow: 0 1px 2px #000; }
        .lbl { color: #fff; margin-right: 3px; }
        .val { color: #ffcc00; font-size: 13px; font-family: monospace; }

        /* --- 5. WHEEL OVERLAY --- */
        .wheel-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 100;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.5s;
        }
        .wheel-overlay.show { opacity: 1; pointer-events: auto; }
        .wheel-group { position: relative; width: 300px; height: 300px; transform: scale(0.8); transition: 0.5s; }
        .wheel-overlay.show .wheel-group { transform: scale(1); }
        .wheel-img { position: absolute; top:0; left:0; width:100%; height:100%; }
        .ball { position: absolute; top: 12%; left: 50%; width: 12px; height: 12px; background: white; border-radius: 50%; display: none; z-index:5; box-shadow: 0 0 10px white; }
        .pointer { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 25px solid gold; z-index: 10; }

        /* Win Popup */
        .win-box {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 250px; height: 120px;
            background: url('assets/win_popup.png') no-repeat center/contain;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 200; transition: 0.3s;
        }
        .win-num { font-size: 60px; color: #fff; font-weight: 900; text-shadow: 0 0 10px gold; margin:0; }

    </style>
</head>
<body>

    <div class="table-view">
        
        <div class="zero-zone click-zone" onclick="placeBet(0, this)"></div>

        <div class="side-bets-container">
            <div class="side-block-1 click-zone" onclick="placeBet('1st12', this)"></div>
            <div class="side-block-2 click-zone" onclick="placeBet('2nd12', this)"></div>
            <div class="side-block-3 click-zone" onclick="placeBet('3rd12', this)"></div>
        </div>

        <div class="numbers-grid" id="numGrid">
            </div>

    </div>

    <div class="timer-badge" id="timerBadge">
        <svg class="timer-svg" viewBox="0 0 50 50">
            <circle class="timer-circle" cx="25" cy="25" r="20"></circle>
        </svg>
        <span class="timer-text" id="timerText">10</span>
    </div>

    <div class="chip-selector-area">
        <div class="arrow-btn up" onclick="changeChip(1)"></div>
        
        <img src="assets/chip_10.png" id="activeChipImg" class="current-chip">
        
        <div class="arrow-btn down" onclick="changeChip(-1)"></div>
    </div>

    <div class="bottom-stats">
        <div class="stat-group">
            <span class="lbl">Total Bet</span><span class="val">Rs<span id="totalBet">0</span></span>
        </div>
        <div class="stat-group">
            <span class="lbl">Balance</span><span class="val">Rs<span id="balance">50000</span></span>
        </div>
    </div>

    <div class="wheel-overlay" id="wheelView">
        <div class="wheel-group">
            <div class="pointer"></div>
            <img src="assets/wheel_outer.png" class="wheel-img">
            <img src="assets/wheel_spinner.png" class="wheel-img" id="spinner">
            <div class="ball" id="ball"></div>
        </div>
        <div class="win-box" id="winModal"><div class="win-num" id="winVal">0</div></div>
    </div>

    <script>
        // --- GAME CONFIG ---
        const chips = [10, 50, 100, 500, 1000];
        const chipFiles = [
            'assets/chip_10.png', 'assets/chip_50.png', 'assets/chip_100.png', 
            'assets/chip_500.png', 'assets/chip_1k.png'
        ];
        
        let chipIndex = 0; // Current selected chip index
        let balance = 50000;
        let currentBet = 0;
        let bets = {};
        let gameState = 'BETTING';
        let timerVal = 10;
        let timerInterval;

        window.onload = () => {
            createGrid();
            startTimer();
        };

        // --- GRID GENERATION (1-36) ---
        function createGrid() {
            const grid = document.getElementById('numGrid');
            // Standard Roulette Layout logic:
            // Col 1: 3, 6, 9... (Top row visually if rotated) - Actually let's assume standard vertical list
            // Row 1: 1, 2, 3
            // Row 2: 4, 5, 6 ...
            for(let i=1; i<=36; i++) {
                const div = document.createElement('div');
                div.className = 'click-zone';
                // div.style.border = '1px solid rgba(255,255,255,0.2)'; // Uncomment to debug grid
                div.onclick = function() { placeBet(i, this); };
                grid.appendChild(div);
            }
        }

        // --- CHIP SELECTOR LOGIC ---
        function changeChip(dir) {
            chipIndex += dir;
            // Loop functionality
            if(chipIndex >= chips.length) chipIndex = 0;
            if(chipIndex < 0) chipIndex = chips.length - 1;

            const img = document.getElementById('activeChipImg');
            // Remove animation class to restart it
            img.classList.remove('chip-anim');
            void img.offsetWidth; // Trigger reflow
            
            img.src = chipFiles[chipIndex];
            img.classList.add('chip-anim');
        }

        // --- BETTING LOGIC ---
        function placeBet(target, el) {
            if(gameState !== 'BETTING') return;
            const amount = chips[chipIndex];
            
            if(balance < amount) { alert("Insufficient Balance"); return; }

            // Update Logic
            balance -= amount;
            currentBet += amount;
            
            if(!bets[target]) bets[target] = 0;
            bets[target] += amount;

            updateUI();

            // Add Chip to Table
            const chip = document.createElement('img');
            chip.src = chipFiles[chipIndex];
            chip.className = 'chip-placed';
            // Slight offset for realism
            chip.style.transform = `translate(-50%, -50%) translate(${Math.random()*6-3}px, ${Math.random()*6-3}px)`;
            
            el.appendChild(chip);
        }

        function updateUI() {
            document.getElementById('balance').innerText = balance;
            document.getElementById('totalBet').innerText = currentBet;
        }

        // --- TIMER & GAME LOOP ---
        function startTimer() {
            gameState = 'BETTING';
            timerVal = 10;
            
            // Clean UI
            document.getElementById('wheelView').classList.remove('show');
            document.getElementById('winModal').style.transform = "translate(-50%, -50%) scale(0)";
            document.querySelectorAll('.chip-placed').forEach(c => c.remove());
            bets = {};
            currentBet = 0;
            updateUI();

            updateTimerUI();

            timerInterval = setInterval(() => {
                timerVal--;
                updateTimerUI();
                if(timerVal <= 0) {
                    clearInterval(timerInterval);
                    spinWheel();
                }
            }, 1000);
        }

        function updateTimerUI() {
            const text = document.getElementById('timerText');
            const badge = document.getElementById('timerBadge');
            const circle = document.querySelector('.timer-circle');
            
            text.innerText = timerVal;
            const offset = 125 - (timerVal / 10) * 125;
            circle.style.strokeDashoffset = offset;

            if(timerVal <= 3) badge.classList.add('timer-danger');
            else badge.classList.remove('timer-danger');
        }

        // --- SPIN LOGIC ---
        function spinWheel() {
            gameState = 'SPINNING';
            document.getElementById('wheelView').classList.add('show');

            const s = document.getElementById('spinner');
            const b = document.getElementById('ball');
            const res = Math.floor(Math.random() * 37);

            // Wheel Spin
            const deg = 1440 + Math.random() * 360;
            s.style.transition = "transform 4s cubic-bezier(0.1, 0.8, 0.1, 1)";
            s.style.transform = `rotate(${deg}deg)`;

            // Ball Spin
            b.style.display = 'block';
            b.animate([
                { transform: 'rotate(0deg) translateY(100px)' },
                { transform: `rotate(-${deg+140}deg) translateY(65px)` }
            ], { duration: 4000, easing: 'cubic-bezier(0.2,0.8,0.1,1)', fill: 'forwards' });

            setTimeout(() => {
                showWin(res);
            }, 4500);
        }

        function showWin(num) {
            const modal = document.getElementById('winModal');
            document.getElementById('winVal').innerText = num;
            modal.style.transform = "translate(-50%, -50%) scale(1)";

            // Simple Payout Logic (Number match only for demo)
            let win = 0;
            if(bets[num]) win = bets[num] * 36;
            
            if(win > 0) {
                balance += win;
                updateUI();
            }

            setTimeout(startTimer, 3000);
        }

    </script>
</body>
</html>

