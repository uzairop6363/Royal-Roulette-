<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Royal Roulette - Fixed</title>
    <style>
        /* --- CORE --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            background: #000;
            font-family: 'Segoe UI', sans-serif;
            height: 100vh; width: 100vw;
            overflow: hidden; /* Body scroll band, sirf table scroll karega */
            display: flex; flex-direction: column;
        }

        /* --- LOADING SCREEN --- */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000 url('assets/poster_roulette.jpg') no-repeat center/cover;
            z-index: 9999; display: flex; flex-direction: column; justify-content: flex-end; align-items: center;
            padding-bottom: 80px; transition: opacity 0.5s;
        }
        .loading-bar { width: 200px; height: 10px; background: #333; border-radius: 5px; overflow: hidden; }
        .bar-fill { height: 100%; width: 0%; background: gold; transition: width 0.1s; }

        /* --- 1. WHEEL SECTION (TOP FIXED) --- */
        .wheel-section {
            height: 240px; /* Fixed height, taake screen na bhare */
            width: 100%;
            background: radial-gradient(circle at center, #2e1000, #000);
            border-bottom: 2px solid gold;
            display: flex; justify-content: center; align-items: center;
            z-index: 20;
            flex-shrink: 0; /* Isay pichakne se roko */
            box-shadow: 0 5px 15px rgba(0,0,0,0.8);
        }
        
        .wheel-group { position: relative; width: 200px; height: 200px; }
        .wheel-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .spinner { transition: transform 4s cubic-bezier(0.1, 0.8, 0.1, 1); }
        .ball { 
            position: absolute; top: 12%; left: 50%; width: 10px; height: 10px; 
            background: white; border-radius: 50%; box-shadow: 0 0 5px white; 
            z-index: 5; display: none; 
        }
        .pointer {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 20px solid gold; z-index: 10;
        }

        /* --- 2. TABLE SECTION (SCROLLABLE BEHIND CHIPS) --- */
        .table-section {
            flex-grow: 1; /* Bachi hui jagah lega */
            position: relative;
            background: #003311;
            overflow-y: auto; /* Scroll ON */
            overflow-x: hidden;
            /* Bottom padding zaroori hai taake last numbers chips ke peeche na chupen */
            padding-bottom: 140px; 
        }

        .table-container {
            width: 100%;
            position: relative;
        }
        .table-bg { width: 100%; display: block; }

        /* Grid Setup */
        .grid-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            /* Padding ko adjust karein apni image ke hisaab se */
            padding: 13% 4% 25% 4%; 
            grid-auto-rows: 1fr;
            gap: 2px;
        }
        .bet-box { position: relative; }

        /* 0 Zone */
        .spot-0 { position: absolute; top: 0; left: 0; width: 100%; height: 11%; z-index: 5; }

        /* Color Zones */
        .side-bets-area {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 25%;
            display: flex;
        }
        .bet-red { width: 50%; height: 100%; }
        .bet-black { width: 50%; height: 100%; }

        .chip {
            position: absolute; top: 50%; left: 50%; width: 30px; height: 30px;
            transform: translate(-50%, -50%) scale(0);
            animation: popIn 0.2s forwards; pointer-events: none;
            filter: drop-shadow(0 2px 2px #000);
            z-index: 10;
        }
        @keyframes popIn { to { transform: translate(-50%, -50%) scale(1); } }

        /* --- 3. CONTROLS (FLOATING/FIXED BOTTOM) --- */
        /* Ye 'absolute' hai, taake ye screen ke upar float kare */
        .controls-overlay {
            position: absolute; 
            bottom: 0; left: 0; 
            width: 100%;
            height: 130px;
            background: linear-gradient(to top, rgba(0,0,0,0.95) 70%, transparent);
            z-index: 100; /* Sabse upar */
            display: flex; flex-direction: column; justify-content: flex-end;
            padding: 10px;
            pointer-events: none; /* Click through transparent parts */
        }

        /* Clickable elements ko wapis pointer-events all denge */
        .balance-float, .chip-rack, .action-row { pointer-events: auto; }

        /* Balance */
        .balance-float {
            position: absolute; top: 20px; left: 15px;
            background: rgba(0,0,0,0.8); border: 1px solid gold; border-radius: 20px;
            padding: 5px 15px; color: gold; font-weight: bold; font-size: 14px;
            box-shadow: 0 4px 5px rgba(0,0,0,0.5);
        }

        /* Chips */
        .chip-rack {
            display: flex; justify-content: center; gap: 10px;
            align-items: center; margin-bottom: 5px;
            pointer-events: auto;
        }
        .chip-btn { 
            width: 50px; height: 50px; cursor: pointer; transition: 0.2s; 
        }
        .chip-btn.active { transform: translateY(-10px) scale(1.15); filter: drop-shadow(0 0 8px gold); }
        .chip-btn img { width: 100%; height: 100%; object-fit: contain; }

        /* Spin Button */
        .action-row {
            position: absolute; bottom: 15px; right: 15px;
            display: flex; gap: 10px; align-items: flex-end;
        }
        .spin-btn {
            width: 80px; height: 80px;
            background: url('assets/btn_spin.png') no-repeat center/contain;
            border: none; cursor: pointer;
            filter: drop-shadow(0 4px 4px #000);
        }
        .spin-btn:active { transform: scale(0.95); }
        .clear-btn {
            width: 45px; height: 45px;
            background: url('assets/btn_clear.png') no-repeat center/contain;
            border: none; cursor: pointer; margin-bottom: 5px;
        }

        /* Win Popup */
        .win-modal {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 250px; height: 120px;
            background: url('assets/win_popup.png') no-repeat center/contain;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 200; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .win-num { font-size: 50px; color: white; font-weight: 900; text-shadow: 0 0 10px gold; margin:0; }

    </style>
</head>
<body>

    <div id="loader">
        <h3 style="color:gold;">LOADING...</h3>
        <div class="loading-bar"><div class="bar-fill" id="bar"></div></div>
    </div>

    <div class="game-wrapper" id="game">
        
        <div class="wheel-section">
            <div class="wheel-group">
                <div class="pointer"></div>
                <img src="assets/wheel_outer.png" class="wheel-img">
                <img src="assets/wheel_spinner.png" class="wheel-img spinner" id="spinner">
                <div class="ball" id="ball"></div>
            </div>
            <div class="win-modal" id="winModal">
                <div class="win-num" id="winVal">0</div>
            </div>
        </div>

        <div class="table-section">
            <div class="table-container">
                <img src="assets/table_layout.jpg" class="table-bg">
                
                <div class="spot-0" onclick="placeBet(0, this)"></div>

                <div class="grid-layer" id="grid"></div>

                <div class="side-bets-area">
                    <div class="bet-red" onclick="placeBet('red', this)"></div>
                    <div class="bet-black" onclick="placeBet('black', this)"></div>
                </div>
            </div>
        </div>

        <div class="controls-overlay">
            <div class="balance-float">
                <span>PKR</span> <span id="balance">50000</span>
            </div>

            <div class="chip-rack">
                <div class="chip-btn active" onclick="setChip(10, 'assets/chip_10.png', this)"><img src="assets/chip_10.png"></div>
                <div class="chip-btn" onclick="setChip(50, 'assets/chip_50.png', this)"><img src="assets/chip_50.png"></div>
                <div class="chip-btn" onclick="setChip(100, 'assets/chip_100.png', this)"><img src="assets/chip_100.png"></div>
                <div class="chip-btn" onclick="setChip(500, 'assets/chip_500.png', this)"><img src="assets/chip_500.png"></div>
                <div class="chip-btn" onclick="setChip(1000, 'assets/chip_1k.png', this)"><img src="assets/chip_1k.png"></div>
            </div>

            <div class="action-row">
                <button class="clear-btn" onclick="clearTable()"></button>
                <button class="spin-btn" onclick="spin()"></button>
            </div>
        </div>

    </div>

    <script>
        // --- LOGIC ---
        window.onload = () => {
            let w=0; const b=document.getElementById('bar');
            const t=setInterval(()=>{ w+=2; b.style.width=w+'%'; if(w>=100){ clearInterval(t); document.getElementById('loader').style.display='none'; document.getElementById('game').classList.add('active'); } }, 20);
            initGrid();
        };

        let balance = 50000;
        let currentChip = 10;
        let currentChipImg = 'assets/chip_10.png';
        let bets = {};
        let isSpinning = false;
        const redNums = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];

        function initGrid() {
            const g = document.getElementById('grid');
            for(let i=1; i<=36; i++) {
                const d = document.createElement('div');
                d.className = 'bet-box';
                d.onclick = function() { placeBet(i, this); };
                g.appendChild(d);
            }
        }

        function setChip(v, i, e) {
            currentChip = v; currentChipImg = i;
            document.querySelectorAll('.chip-btn').forEach(x => x.classList.remove('active'));
            e.classList.add('active');
        }

        function placeBet(target, el) {
            if(isSpinning || balance < currentChip) return;
            balance -= currentChip;
            document.getElementById('balance').innerText = balance;
            
            if(!bets[target]) bets[target]=0; 
            bets[target] += currentChip;

            const c = document.createElement('img');
            c.src = currentChipImg; c.className = 'chip';
            c.style.transform = `translate(-50%, -50%) translate(${Math.random()*6-3}px, ${Math.random()*6-3}px)`;
            el.appendChild(c);
        }

        function clearTable() {
            if(isSpinning) return;
            document.querySelectorAll('.chip').forEach(c => c.remove());
            bets = {};
        }

        function spin() {
            if(isSpinning || Object.keys(bets).length===0) return;
            isSpinning = true;
            document.getElementById('winModal').style.transform = "translate(-50%, -50%) scale(0)";

            const s = document.getElementById('spinner');
            const ball = document.getElementById('ball');
            const res = Math.floor(Math.random() * 37);
            
            const deg = 1440 + Math.random()*360;
            s.style.transform = `rotate(${deg}deg)`;
            
            ball.style.display = 'block';
            ball.animate([
                { transform: 'rotate(0deg) translateY(85px)' },
                { transform: `rotate(-${deg+120}deg) translateY(50px)` }
            ], { duration: 4000, easing: 'cubic-bezier(0.2,0.8,0.1,1)', fill: 'forwards' });

            setTimeout(() => { checkWin(res); isSpinning = false; }, 4200);
        }

        function checkWin(n) {
            const m = document.getElementById('winModal');
            document.getElementById('winVal').innerText = n;
            m.style.transform = "translate(-50%, -50%) scale(1)";
            
            let win = 0;
            if(bets[n]) win += bets[n]*36;
            let col = (n!==0 && redNums.includes(n)) ? 'red' : 'black';
            if(bets[col]) win += bets[col]*2;

            if(win > 0) {
                balance += win;
                document.getElementById('balance').innerText = balance;
                setTimeout(() => alert(`YOU WON PKR ${win}!`), 500);
            }
            
            setTimeout(() => { clearTable(); m.style.transform = "translate(-50%, -50%) scale(0)"; }, 3000);
        }
    </script>
</body>
</html>
