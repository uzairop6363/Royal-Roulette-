<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Royal Roulette - Final Fixed</title>
    <style>
        /* --- 1. CORE RESET --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        body {
            margin: 0; padding: 0;
            background-color: #000;
            height: 100vh; width: 100vw;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            font-family: Arial, sans-serif;
        }

        /* --- 2. THE GAME STAGE (ASPECT RATIO LOCK) --- */
        /* Ye sabse zaroori cheez hai. Ye container game ko hamesha 9:16 shape me rakhega */
        #game-stage {
            position: relative;
            width: 100vh; /* Height ke hisaab se width adjust hogi */
            height: 100vh; 
            max-width: 100vw; /* Screen se bahar na jaye */
            aspect-ratio: 9/16; /* Portrait Ratio Lock */
            background: #120505;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        /* Background Table Image */
        .table-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: url('assets/table_dark.jpg') no-repeat center/100% 100%;
            z-index: 1;
        }

        /* --- 3. PRECISE GRID SYSTEM --- */
        /* Is grid ko maine image ke hisaab se adjust kiya hai */
        .grid-layer {
            position: absolute;
            top: 14%;       /* Table numbers yahan se shuru hoty hain */
            left: 4.5%;     /* Left margin */
            width: 91%;     /* Table width */
            height: 72%;    /* Table height */
            z-index: 10;
            display: grid;
            grid-template-columns: 20% 1fr 1fr 1fr; /* Left Sidebar + 3 Number Cols */
            gap: 1px;
        }

        /* Generic Click Zone */
        .zone { position: relative; /* border: 1px solid rgba(255,255,0,0.1); Debug only */ }

        /* Left Side Bets (1st 12, etc) */
        .sidebar-zone { grid-column: 1; grid-row: span 4; }

        /* Special Zero Zone */
        .zero-zone {
            position: absolute; top: 7.5%; left: 24%; width: 71.5%; height: 6.5%;
            z-index: 15; /* border: 1px solid red; */
        }

        /* Chips on Table */
        .chip {
            position: absolute; top: 50%; left: 50%;
            width: 80%; /* Box ke hisaab se size */
            max-width: 35px; aspect-ratio: 1;
            transform: translate(-50%, -50%) scale(0);
            animation: dropIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            pointer-events: none;
            filter: drop-shadow(0 3px 5px rgba(0,0,0,0.8));
            z-index: 20;
        }
        @keyframes dropIn { to { transform: translate(-50%, -50%) scale(1); } }

        /* --- 4. UI ELEMENTS --- */
        
        /* Timer (Top Left) */
        .timer-badge {
            position: absolute; top: 2%; left: 3%;
            width: 12%; aspect-ratio: 1;
            background: rgba(0,0,0,0.7); border: 2px solid gold; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; z-index: 50;
        }
        .timer-text { color: white; font-weight: bold; font-size: clamp(14px, 4vw, 20px); }
        .timer-red { border-color: red; color: red; animation: blink 0.5s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        /* Right Side Chip Selector (Single Chip + Arrows) */
        .chip-panel {
            position: absolute; right: 2%; top: 50%; transform: translateY(-50%);
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            z-index: 60;
        }
        .arrow {
            width: 40px; height: 40px;
            background: url('assets/btn_arrow.png') no-repeat center/contain;
            cursor: pointer; filter: drop-shadow(0 2px 2px #000);
        }
        .arrow.down { transform: rotate(180deg); }
        .arrow:active { transform: scale(0.9) rotate(inherit); }
        
        .selected-chip-display {
            width: 70px; height: 70px;
            transition: transform 0.2s;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.8));
        }
        .chip-bounce { animation: bounce 0.3s; }
        @keyframes bounce { 0%{transform:scale(0.8);} 50%{transform:scale(1.1);} 100%{transform:scale(1);} }

        /* Bottom Info Bar (Minimal) */
        .bottom-bar {
            position: absolute; bottom: 0; left: 0; width: 100%;
            height: 6%; background: rgba(0,0,0,0.9);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px; border-top: 1px solid #333; z-index: 60;
        }
        .info-group { display: flex; flex-direction: column; }
        .info-label { color: #aaa; font-size: 10px; }
        .info-val { color: #ffd700; font-weight: bold; font-size: 14px; }

        /* Wheel Overlay */
        .overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.95); z-index: 100;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: 0.5s;
        }
        .overlay.active { opacity: 1; pointer-events: auto; }
        .wheel-box { position: relative; width: 85%; aspect-ratio: 1; transform: scale(0.8); transition: 0.5s; }
        .overlay.active .wheel-box { transform: scale(1); }
        .w-img { position: absolute; width:100%; height:100%; }
        .pointer { position: absolute; top:-2%; left:48%; width:4%; height:8%; background:gold; clip-path: polygon(50% 100%, 0 0, 100% 0); z-index:10; }
        
        /* Win Popup */
        .win-modal {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 70%; aspect-ratio: 2/1;
            background: url('assets/win_popup.png') no-repeat center/contain;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 200; transition: 0.3s;
        }
        .win-txt { font-size: 40px; color: gold; font-weight: 900; text-shadow: 0 2px 5px #000; margin:0; }

    </style>
</head>
<body>

    <div id="game-stage">
        
        <div class="table-bg"></div>

        <div class="zero-zone zone" onclick="placeBet(0, this)"></div>

        <div class="grid-layer" id="grid">
            <div class="sidebar-zone zone" onclick="placeBet('1st12', this)"></div>
            <div class="sidebar-zone zone" onclick="placeBet('2nd12', this)"></div>
            <div class="sidebar-zone zone" onclick="placeBet('3rd12', this)"></div>
            
            </div>

        <div class="timer-badge" id="timerBadge">
            <span class="timer-text" id="timer">10</span>
        </div>

        <div class="chip-panel">
            <div class="arrow up" onclick="changeChip(1)"></div>
            <img src="assets/chip_10.png" id="chipDisplay" class="selected-chip-display">
            <div class="arrow down" onclick="changeChip(-1)"></div>
        </div>

        <div class="bottom-bar">
            <div class="info-group">
                <span class="info-label">Total Bet</span>
                <span class="info-val">Rs<span id="betTxt">0</span></span>
            </div>
            <div class="info-group" style="align-items: flex-end;">
                <span class="info-label">Balance</span>
                <span class="info-val">Rs<span id="balTxt">50000</span></span>
            </div>
        </div>

        <div class="overlay" id="wheelLayer">
            <div class="wheel-box">
                <div class="pointer"></div>
                <img src="assets/wheel_outer.png" class="w-img">
                <img src="assets/wheel_spinner.png" class="w-img" id="spinner">
            </div>
            <div class="win-modal" id="winModal">
                <h1 class="win-txt" id="winNum">0</h1>
            </div>
        </div>

    </div>

    <script>
        // --- DATA ---
        const chips = [10, 50, 100, 500, 1000];
        const chipImgs = ['assets/chip_10.png', 'assets/chip_50.png', 'assets/chip_100.png', 'assets/chip_500.png', 'assets/chip_1k.png'];
        let chipIdx = 0;
        
        let balance = 50000;
        let currentBet = 0;
        let bets = {};
        let time = 10;
        let timerInt;

        window.onload = () => {
            createTable();
            startRound();
        };

        function createTable() {
            const grid = document.getElementById('grid');
            // Create 36 boxes. 
            // NOTE: Grid fills Row by Row. 
            // Row 1: 1, 2, 3
            // Row 2: 4, 5, 6 etc.
            for(let i=1; i<=36; i++) {
                const d = document.createElement('div');
                d.className = 'zone';
                d.onclick = function() { placeBet(i, this); };
                grid.appendChild(d);
            }
        }

        // --- CHIP LOGIC ---
        function changeChip(dir) {
            chipIdx += dir;
            if(chipIdx >= chips.length) chipIdx=0;
            if(chipIdx < 0) chipIdx = chips.length-1;
            
            const img = document.getElementById('chipDisplay');
            img.classList.remove('chip-bounce');
            void img.offsetWidth; // reset anim
            img.src = chipImgs[chipIdx];
            img.classList.add('chip-bounce');
        }

        // --- BETTING ---
        function placeBet(target, el) {
            if(time <= 0) return; // Betting closed
            const amt = chips[chipIdx];
            if(balance < amt) return;

            balance -= amt;
            currentBet += amt;
            
            if(!bets[target]) bets[target] = 0;
            bets[target] += amt;

            updateUI();

            const c = document.createElement('img');
            c.src = chipImgs[chipIdx];
            c.className = 'chip';
            // Slight random offset so they stack naturally
            const rx = (Math.random() * 10) - 5;
            const ry = (Math.random() * 10) - 5;
            c.style.transform = `translate(-50%, -50%) translate(${rx}px, ${ry}px)`;
            el.appendChild(c);
        }

        function updateUI() {
            document.getElementById('balTxt').innerText = balance;
            document.getElementById('betTxt').innerText = currentBet;
        }

        // --- GAME LOOP ---
        function startRound() {
            time = 10;
            bets = {};
            currentBet = 0;
            updateUI();
            
            // Cleanup
            document.querySelectorAll('.chip').forEach(c => c.remove());
            document.getElementById('wheelLayer').classList.remove('active');
            document.getElementById('winModal').style.transform = "translate(-50%, -50%) scale(0)";
            document.getElementById('timerBadge').classList.remove('timer-red');

            timerInt = setInterval(() => {
                time--;
                document.getElementById('timer').innerText = time;
                
                if(time <= 3) document.getElementById('timerBadge').classList.add('timer-red');

                if(time <= 0) {
                    clearInterval(timerInt);
                    spinWheel();
                }
            }, 1000);
        }

        function spinWheel() {
            const overlay = document.getElementById('wheelLayer');
            const spinner = document.getElementById('spinner');
            overlay.classList.add('active');

            const res = Math.floor(Math.random() * 37);
            const deg = 1080 + Math.random() * 360; // 3+ full spins

            spinner.style.transition = "transform 4s cubic-bezier(0.3, 1, 0.2, 1)";
            spinner.style.transform = `rotate(${deg}deg)`;

            setTimeout(() => showWin(res), 4500);
        }

        function showWin(num) {
            document.getElementById('winNum').innerText = num;
            document.getElementById('winModal').style.transform = "translate(-50%, -50%) scale(1)";

            let win = 0;
            if(bets[num]) win = bets[num] * 36;
            // Add other logic (Red/Black) here based on 'num'

            if(win > 0) balance += win;
            
            setTimeout(startRound, 3000);
        }

    </script>
</body>
</html>
